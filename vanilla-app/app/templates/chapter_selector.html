{% load static %}

<style>
  .book-entry:hover {
    background-color: rgba(243, 244, 246, 1);
  }
  .chapter-entry:hover {
    background-color: rgba(239, 68, 68, 1);
    color: rgba(255, 255, 255, 1);
  }
  .dropdown-container {
    max-height: 300px;
    overflow-y: auto;
  }
</style>

<div class="relative">
  <div id="bookDropdown" class="hidden absolute top-0 left-0 z-10 bg-white border border-gray-200 shadow-md p-2 dropdown-container">
    <!-- Dropdown menu content will be added here -->
  </div>
  <div id="chapterDropdown" class="hidden absolute top-0 left-full z-10 bg-white border border-gray-200 shadow-md p-2 dropdown-container">
    <!-- Chapter grid content will be added here -->
  </div>
</div>

<script>
  function createChapterGrid(book) {
    const chapterGrid = document.createElement('div');
    chapterGrid.className = 'chapter-grid grid grid-cols-4 gap-1 p-2';

    for (let i = 1; i <= book.chapters; i++) {
      const chapterElement = document.createElement('div');
      chapterElement.className = 'chapter-entry py-1 px-2 hover:bg-red-500 cursor-pointer text-center';
      chapterElement.textContent = i;

      chapterElement.addEventListener('click', async () => {
        const requestData = {
          book_number: book.number,
          chapter_number: i
        };

        try {
          const response = await fetch('/load_chapter', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
          });

          if (!response.ok) {
            throw new Error(`HTTP error ${response.status}`);
          }

          const chapterData = await response.json();

          // Handle the received chapter data here

        } catch (error) {
          console.error('Failed to load chapter:', error);
        }
      });

      chapterGrid.appendChild(chapterElement);
    }

    return chapterGrid;
  }

  function createBookDropdown(books) {
    const dropdown = document.getElementById('bookDropdown');
    dropdown.innerHTML = '';

    for (const book of books) {
      const bookElement = document.createElement('div');
      bookElement.className = 'book-entry py-1 px-2 hover:bg-gray-200 cursor-pointer';

      const bookTitle = document.createElement('span');
      bookTitle.textContent = book.name;
      bookElement.appendChild(bookTitle);

      bookElement.addEventListener('click', () => {
        const chapterGrid = createChapterGrid(book);
        const chapterDropdown = document.getElementById('chapterDropdown');

        chapterDropdown.innerHTML = '';
        chapterDropdown.appendChild(chapterGrid);
        chapterDropdown.classList.remove('hidden');
      });

      dropdown.appendChild(bookElement);
    }
  }

  function initializeBookSelectionButton(books) {
  document.getElementById('bookSelectionButton').addEventListener('click', () => {
    const dropdown = document.getElementById('bookDropdown');
    if (dropdown.classList.contains('hidden')) {
      createBookDropdown(books);
      dropdown.classList.remove('hidden');

      const buttonRect = document.getElementById('bookSelectionButton').getBoundingClientRect();
      dropdown.style.left = `${buttonRect.left}px`;
    } else {
      dropdown.classList.add('hidden');
    }
  });
}

  //   function createChapterGrid(book) {
//   const chapterGrid = document.createElement('div');
//   chapterGrid.className = 'chapter-grid grid grid-cols-4 gap-1 absolute top-0 left-full p-2 bg-white border border-gray-200 shadow-md z-10';
//     console.log(book)
//   for (let i = 1; i <= book.chapters; i++) {
//     const chapterElement = document.createElement('div');
//     chapterElement.className = 'chapter-entry py-1 px-2 hover:bg-blue-200 cursor-pointer';
//     chapterElement.textContent = i;

//     chapterElement.addEventListener('click', async () => {
//       const requestData = {
//         book_number: book.number,
//         chapter_number: i
//       };

//       try {
//         const response = await fetch('/load_chapter', {
//           method: 'POST',
//           headers: {
//             'Content-Type': 'application/json'
//           },
//           body: JSON.stringify(requestData)
//         });

//         if (!response.ok) {
//           throw new Error(`HTTP error ${response.status}`);
//         }

//         const chapterData = await response.json();

//         // Handle the received chapter data here

//       } catch (error) {
//         console.error('Failed to load chapter:', error);
//       }
//     });

//     chapterGrid.appendChild(chapterElement);
//   }

//   return chapterGrid;
// }

// function createBookDropdown() {
//   const books = contextToJson('{{ books|escapejs }}');

//   const dropdown = document.getElementById('bookDropdown');
//   dropdown.innerHTML = '';

//   for (const book of books) {
//     const bookElement = document.createElement('div');
//     bookElement.className = 'book-entry py-1 px-2 hover:bg-blue-200 cursor-pointer relative';

//     const bookTitle = document.createElement('span');
//     bookTitle.textContent = book.name;
//     bookElement.appendChild(bookTitle);

//     bookElement.addEventListener('click', () => {
//       const chapterGrid = createChapterGrid(book);

//       if (bookElement.lastElementChild !== bookTitle) {
//         bookElement.removeChild(bookElement.lastElementChild);
//       } else {
//         bookElement.appendChild(chapterGrid);
//       }
//     });

//     dropdown.appendChild(bookElement);
//   }
// }

</script>

