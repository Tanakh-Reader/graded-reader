{% extends 'layout.html' %}
{% load static %}

{% block title %}Passages Page{% endblock %}

{% block content %}

<div class="container mx-auto px-4">
  <h1 class="text-4xl font-bold my-8">Passages</h1>
  <form method="get" class="mb-8">
    <div class="flex items-center">
      <label for="book" class="mr-4 font-bold">Book:</label>
      <select name="book" id="book" class="border border-gray-400 rounded px-2 py-1">
        {% for book in books %}
        <option value="{{ book.id }}">{{ book.name }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="bg-blue-500 text-white ml-4 px-4 py-2 rounded hover:bg-blue-600 transition duration-200">Search</button>
    </div>
  </form>
  {% if passages %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for passage in passages %}
    <div class="bg-white rounded shadow-lg overflow-hidden" onclick="redirectToRead('{{ passage.reference }}')">
      <div class="p-4">
        <h2 class="text-lg font-bold mb-2">{{ passage.reference }}</h2>
        <p class="text-gray-700 mb-2">Weight: {{ passage.weight }}<br>Length: {{ passage.length }} words</p>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p>No passages found.</p>
  {% endif %}
  {% if paginator %}
  <nav class="mt-8">
    <ul class="pagination flex justify-center">
      {% if paginator.has_previous %}
      <li class="mr-2">
        <a class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded transition duration-200" href="?page={{ paginator.previous_page_number }}{% if book %}&book={{ book }}{% endif %}" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous</span>
        </a>
      </li>
      {% endif %}
      {% for page in paginator.page_range %}
      {% if page == paginator.number %}
      <li class="mr-2"><a class="px-4 py-2 bg-blue-500 text-white font-bold rounded transition duration-200" href="#">{{ page }}</a></li>
      {% else %}
      <li class="mr-2"><a class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded transition duration-200" href="?page={{ page }}{% if book %}&book={{ book }}{% endif %}">{{ page }}</a></li>
      {% endif %}
      {% endfor %}
      {% if paginator.has_next %}
      <li class="mr-2">
        <a class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded transition duration-200" href="?page={{ paginator.next_page_number }}{% if book %}&book={{ book }}{% endif %}" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
          <span class="sr-only">Next</span>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>

<script>

  function redirectToRead(reference) {
    const book = reference.split(':')[0];
    const chapter = reference.split(':')[1];
    const url = "{% url 'read' %}?reference=" + book + "," + 1;
    window.location = url;
  }
  
  </script>
{% endblock %}
