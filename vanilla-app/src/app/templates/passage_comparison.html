{% extends 'layout.html' %}
{% load static %}
{% load list_extras %}

{% block title %}Passages Page{% endblock %}

{% block content %}

    <div class="my-10 rounded-md bg-slate-50 p-4 shadow-lg">
        <!-- Algorithm form -->
        <button class="toggle-form-button">
            <span class="material-icons md-42">precision_manufacturing</span>
        </button>
        <form class="my-6"
              method="post"
              action="{% url 'post_algorithms' %}">
            {% csrf_token %}
            <div class="flex flex-row justify-between gap-10 rounded-md bg-white p-2">
                <!-- Saved algorithms -->
                <div class="dropdown-container">
                    <select name="algorithm1" class="rounded border px-2">
                        <option disabled selected value="">ALGORITHM A</option>
                        <!-- Default option -->
                        {% for obj in algorithms %}
                            {% if obj.id == algA %}
                                <option selected
                                        value="{{ obj.id }}"
                                        data-definition="{{ obj }}"
                                        data-index="1">{{ obj.name }}</option>
                            {% else %}
                                <option value="{{ obj.id }}"
                                        data-definition="{{ obj }}"
                                        data-index="1">{{ obj.name }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="dropdown-container">
                    <select name="algorithm2" class="rounded border px-2">
                        <option disabled selected value="">ALGORITHM B</option>
                        <!-- Default option -->
                        {% for obj in algorithms %}
                            {% if obj.id == algB %}
                                <option selected
                                        value="{{ obj.id }}"
                                        data-definition="{{ obj }}"
                                        data-index="2">{{ obj.name }}</option>
                            {% else %}
                                <option value="{{ obj.id }}"
                                        data-definition="{{ obj }}"
                                        data-index="2">{{ obj.name }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div>
                    Top
                    <input type="number"
                           name="count"
                           value="{{ count }}"
                           min="0"
                           class="w-14 rounded border px-1"
                           id="passage-count">
                    passages
                </div>
                <div>
                    <button class="rounded bg-green-300 px-1" type="submit">Run</button>
                </div>
            </div>
        </form>

        <!-- Display algorithms -->

        <div id="algorithm-definitions"
             class="flex space-x-12">
            <div id="algorithm-1"
                 class="hidden w-64 flex-col gap-2 rounded bg-white p-3">
                <div class="mb-2 font-bold">Algorithm A</div>
                <div class="freq flex flex-col text-sm">
                    {% comment %} <div class="font-bold">Frequencies</div> {% endcomment %}
                </div>
                <div class="morph flex flex-col text-sm">
                    {% comment %} <div class="font-bold">Morphology</div> {% endcomment %}
                </div>
            </div>
            <div id="algorithm-2"
                 class="hidden w-64 flex-col gap-2 rounded bg-white p-3">
                <div class="mb-2 font-bold">Algorithm B</div>
                <div class="freq flex flex-col text-sm">
                    {% comment %} <div class="font-bold">Frequencies</div> {% endcomment %}
                </div>
                <div class="morph flex flex-col text-sm">
                    {% comment %} <div class="font-bold">Morphology</div> {% endcomment %}
                </div>
            </div>
        </div>
    </div>

    <div id="comparisons"
         class="hidden max-w-3xl flex-col items-center">

        <!-- Summary div -->

        <div class="my-10 flex w-fit space-x-6 rounded-md bg-slate-50 p-4 shadow-md">
            <div class="flex flex-col gap-3">
                <p class="text-2xl">Comparison Summary</p>
                <div id ="summary-heading"></div>
            </div>
            <div id="summary-passages" class="flex flex-col gap-1"></div>
        </div>

        <!-- Passage Lists Spreadsheet -->

        <div class="relative flex justify-center gap-3">
            <div id="column-0"
                 class="flex flex-col items-center gap-1">
                <!-- Column 1 Header -->
                <div class="mb-2 font-bold">‎</div>
                <!-- Column 1 Items -->
                {% for item in listA %}
                    <div class="flex border border-transparent">
                        <div class="passage-index hover:font-bold hover:text-blue-500"
                             data-passage="{{ item.0 }}">
                            {{ forloop.counter }}
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div id="column-1"
                 class="mr-52 flex flex-col items-end gap-1">
                <!-- Column 1 Header -->
                <div class="mb-2 font-bold">Algorithm A</div>
                <!-- Column 1 Items -->
                {% for item in listA %}
                    <div class="col-1 passage-item flex w-60 overflow-hidden rounded-md border border-black"
                         data-passage="{{ item.0 }}"
                         data-id="{{ item.0.id }}"
                         data-index="{{ forloop.counter }}">
                        <div class="w-1/3 bg-red-100 px-2">{{ item.1 }}</div>
                        <div class="w-2/3 bg-gray-100 px-2 text-right">
                            {{ item.0.reference_abbr }}
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div id="column-2"
                 class="flex flex-col items-start gap-1">
                <!-- Column 2 Header -->
                <div class="mb-2 font-bold">Algorithm B</div>
                <!-- Column 2 Items -->
                {% for item in listB %}
                    <div class="col-2 passage-item flex w-60 overflow-hidden rounded-md border border-black"
                         data-passage="{{ item.0 }}"
                         data-id="{{ item.0.id }}"
                         data-index="{{ forloop.counter }}">
                        <div class="w-2/3 bg-gray-100 px-2">{{ item.0.reference_abbr }}</div>
                        <div class="w-1/3 bg-red-100 px-2">{{ item.1 }}</div>
                    </div>
                {% endfor %}
            </div>
            <div class="flex flex-col items-center gap-1">
                <!-- Column 1 Header -->
                <div class="mb-2 font-bold">‎</div>
                <!-- Column 1 Items -->
                {% for item in listB %}
                    <div class="flex border border-transparent">
                        <div class="passage-index hover:cursor-pointer hover:font-bold hover:text-blue-500"
                             data-passage="{{ item.0 }}">
                            {{ forloop.counter }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div id="passage-text"
             class="my-14 hidden w-3/4"
             data-id="{{ text_passage.id }}"></div>
    </div>

    <!-- div displayed when a passage is hovered over -->
    <div id="hover-text"
         class="absolute z-50 hidden rounded border border-gray-400 bg-white px-1 shadow-lg">
    </div>

    <!--  USED by the API CALL -->
    <div class="algorithm-form-container"></div>

    <!-- Selected word data -->
    {% include 'widgets/selected_word.html' %}

    <script src="{% static 'js/libraries/leader-line.min.js' %}"></script>
    <script type="module"
            src="{% static 'js/passage_lists.js' %}"></script>
    <script type="module"
            src="{% static 'js/widgets/hebrew_text.js' %}"></script>
    <script type="module"
            src="{% static 'js/widgets/algorithm_form.js' %}"></script>

{% endblock %}
